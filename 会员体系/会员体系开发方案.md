# 会员体系开发方案

## 一、项目概述

### 1.1 项目背景
会员体系是数智服务港的重要组成部分，旨在为个人用户提供技能展示、任务认领、收益获取、信用评价等功能，打造专业的服务者生态。

### 1.2 项目目标
- 建立完善的会员档案管理系统
- 提供便捷的任务认领和交付流程
- 实现透明化的收益和回报机制
- 构建可信赖的信用评价体系
- 支持个人技能和作品的展示

### 1.3 技术栈

**后端技术**
- Node.js - 运行环境
- Express.js - Web 框架
- MySQL - 数据库
- JWT - 身份认证
- Multer - 文件上传
- CORS - 跨域支持

**前端技术**
- Vue 3 - 前端框架
- Vite - 构建工具
- Element Plus - UI 组件库
- Vue Router - 路由管理
- Pinia - 状态管理
- Axios - HTTP 客户端

---

## 二、功能模块设计

### 2.1 用户认证模块

#### 2.1.1 会员注册
**功能描述**
- 用户填写基本信息注册账号
- 创建会员档案
- 初始化默认数据

**核心流程**
1. 用户填写注册表单（用户名、密码、手机号、邮箱）
2. 前端验证数据格式
3. 调用后端注册接口
4. 后端创建用户账号和会员档案
5. 返回注册成功信息

**接口设计**
```
POST /api/auth/register
Request Body:
{
  username: string,
  password: string,
  phone: string,
  email: string
}

Response:
{
  success: true,
  message: "注册成功",
  data: {
    user_id: number,
    token: string
  }
}
```

#### 2.1.2 会员登录
**功能描述**
- 用户使用用户名/手机号/邮箱登录
- 生成 JWT Token
- 保存用户信息到状态管理

**核心流程**
1. 用户输入账号密码
2. 调用登录接口
3. 后端验证凭证
4. 生成 JWT Token
5. 返回用户信息和 Token
6. 前端保存 Token

**接口设计**
```
POST /api/auth/login
Request Body:
{
  account: string,  // 用户名/手机号/邮箱
  password: string
}

Response:
{
  success: true,
  data: {
    user: { user_id, username, ... },
    token: string
  }
}
```

#### 2.1.3 身份认证
**功能描述**
- 验证请求的合法性
- 解析 Token 获取用户信息
- 拦截未授权请求

**实现方式**
- JWT 中间件验证 Token
- 将用户信息挂载到 req.user
- 返回 401 状态码未授权请求

---

### 2.2 会员个人中心模块

#### 2.2.1 会员档案管理

**基本信息管理**
- 显示会员基本信息
- 编辑个人资料
- 头像上传

**接口设计**
```
GET /api/members/profile
Response: { member: { ... } }

PUT /api/members/profile
Request Body: { real_name, phone, email, bio, ... }

POST /api/members/avatar
Request: multipart/form-data (avatar file)
```

**技能管理**
- 添加专业技能
- 显示技能列表
- 删除技能
- 技能等级设置

**接口设计**
```
POST /api/members/skills
Request Body: { skill_name, skill_level, description }

GET /api/members/skills
Response: { skills: [...] }

DELETE /api/members/skills/:id
```

**证书管理**
- 上传专业证书
- 显示证书列表
- 删除证书

**作品集管理**
- 上传作品案例
- 显示作品集
- 删除作品

#### 2.2.2 信用评分系统

**评分规则**
- 基础分：100 分
- 完成任务 +5 分/次
- 超时交付 -2 分/次
- 差评 -10 分/次
- 好评 +3 分/次

**评分显示**
- 仪表盘展示当前信用分
- 显示信用等级（优秀/良好/一般/较差）
- 显示最近评分变化记录

**接口设计**
```
GET /api/members/credit-score
Response: { 
  score: number,
  level: string,
  change_history: [...]
}

GET /api/members/reviews
Response: { reviews: [...] }
```

---

### 2.3 任务认领模块

#### 2.3.1 任务大厅

**任务列表展示**
- 显示所有可认领的任务
- 支持分类筛选
- 支持价格区间筛选
- 支持搜索功能
- 支持排序（最新/价格/信用）

**任务卡片信息**
- 任务标题
- 任务描述摘要
- 任务价格
- 发布方信息
- 任务状态
- 截止日期

**接口设计**
```
GET /api/tasks/list?category=&price_min=&price_max=&keyword=&sort=&page=
Response: {
  tasks: [...],
  total: number,
  page: number,
  pageSize: number
}
```

#### 2.3.2 任务详情

**详情展示**
- 完整任务描述
- 任务要求
- 交付标准
- 附件下载
- 发布方信息
- 相关任务推荐

**接口设计**
```
GET /api/tasks/:id
Response: { task: {...} }
```

#### 2.3.3 任务认领

**认领流程**
1. 会员查看任务详情
2. 确认认领任务
3. 系统验证会员资格
4. 创建认领记录
5. 通知发布方

**认领限制**
- 单任务只允许一人认领
- 信用分低于 80 不能认领
- 有未完成任务不能认领新任务

**接口设计**
```
POST /api/tasks/:id/claim
Response: {
  success: true,
  message: "认领成功",
  data: { claim_id: number }
}
```

#### 2.3.4 任务进度管理

**进度更新**
- 上传工作进度
- 提交阶段成果
- 与发布方沟通

**进度状态**
- 进行中
- 待审核
- 已完成
- 已取消

**接口设计**
```
PUT /api/tasks/:id/progress
Request Body: { progress: number, status: string, notes: string }

GET /api/tasks/my-claims
Response: { claims: [...] }
```

#### 2.3.5 任务交付

**交付流程**
1. 会员完成全部工作
2. 上传最终交付物
3. 提交交付申请
4. 发布方审核
5. 确认完成或要求修改

**接口设计**
```
POST /api/tasks/:id/submit
Request Body: {
  deliverables: string,
  description: string,
  attachments: []
}

PUT /api/tasks/:id/cancel
Request Body: { reason: string }
```

---

### 2.4 任务回报模块

#### 2.4.1 收益统计

**统计数据**
- 总收益
- 已到账金额
- 待结算金额
- 已提现金额
- 任务数量统计

**接口设计**
```
GET /api/rewards/statistics
Response: {
  total_income: number,
  received: number,
  pending: number,
  withdrawn: number,
  task_count: number
}
```

#### 2.4.2 回报记录

**记录列表**
- 任务名称
- 任务价格
- 收益金额
- 结算状态
- 结算时间

**接口设计**
```
GET /api/rewards/records?page=&status=
Response: {
  records: [...],
  total: number
}
```

#### 2.4.3 提现功能

**提现规则**
- 最低提现金额：100 元
- 提现手续费：2%
- 到账时间：1-3 个工作日
- 每日限额：5000 元

**提现流程**
1. 申请提现
2. 填写提现金额和账户
3. 系统审核
4. 批准/拒绝提现
5. 到账通知

**接口设计**
```
POST /api/rewards/withdraw
Request Body: {
  amount: number,
  bank_name: string,
  account_number: string,
  account_name: string
}

Response: {
  success: true,
  message: "提现申请已提交",
  data: { withdraw_id: number }
}

GET /api/rewards/withdraw-history
Response: { history: [...] }
```

---

### 2.5 信用评价模块

#### 2.5.1 评价功能

**评价维度**
- 交付质量（5星）
- 响应速度（5星）
- 沟通顺畅度（5星）
- 专业程度（5星）

**评价类型**
- 好评（4-5星）
- 中评（3星）
- 差评（1-2星）

**接口设计**
```
POST /api/reviews
Request Body: {
  target_member_id: number,
  task_id: number,
  rating: number,  // 1-5
  tags: [],
  content: string,
  is_anonymous: boolean
}

Response: {
  success: true,
  message: "评价成功"
}
```

#### 2.5.2 评价展示

**展示位置**
- 个人中心首页
- 会员详情页
- 任务详情页

**展示内容**
- 平均评分
- 评价数量
- 好评率
- 最新评价列表

**接口设计**
```
GET /api/reviews/member/:member_id
Response: {
  average_rating: number,
  total_reviews: number,
  positive_rate: number,
  reviews: [...]
}
```

---

## 三、数据库设计

### 3.1 核心数据表

#### 3.1.1 用户表 (users)
```sql
CREATE TABLE users (
  user_id INT PRIMARY KEY AUTO_INCREMENT,
  username VARCHAR(50) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  phone VARCHAR(20),
  email VARCHAR(100),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 3.1.2 会员表 (members)
```sql
CREATE TABLE members (
  member_id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT UNIQUE NOT NULL,
  real_name VARCHAR(50),
  nickname VARCHAR(50),
  avatar VARCHAR(255),
  bio TEXT,
  credit_score INT DEFAULT 100,
  total_income DECIMAL(10,2) DEFAULT 0,
  task_count INT DEFAULT 0,
  status ENUM('active', 'suspended') DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(user_id)
);
```

#### 3.1.3 会员技能表 (member_skills)
```sql
CREATE TABLE member_skills (
  skill_id INT PRIMARY KEY AUTO_INCREMENT,
  member_id INT NOT NULL,
  skill_name VARCHAR(50) NOT NULL,
  skill_level ENUM('初级', '中级', '高级', '专家'),
  description TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (member_id) REFERENCES members(member_id)
);
```

#### 3.1.4 任务认领表 (task_claims)
```sql
CREATE TABLE task_claims (
  claim_id INT PRIMARY KEY AUTO_INCREMENT,
  task_id INT NOT NULL,
  member_id INT NOT NULL,
  status ENUM('pending', 'in_progress', 'submitted', 'completed', 'cancelled') DEFAULT 'pending',
  progress INT DEFAULT 0,
  claim_notes TEXT,
  deliverables TEXT,
  claimed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  completed_at TIMESTAMP NULL,
  FOREIGN KEY (member_id) REFERENCES members(member_id)
);
```

#### 3.1.5 回报记录表 (reward_records)
```sql
CREATE TABLE reward_records (
  record_id INT PRIMARY KEY AUTO_INCREMENT,
  member_id INT NOT NULL,
  task_id INT NOT NULL,
  amount DECIMAL(10,2) NOT NULL,
  status ENUM('pending', 'received', 'withdrawn') DEFAULT 'pending',
  settlement_at TIMESTAMP NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (member_id) REFERENCES members(member_id)
);
```

#### 3.1.6 评价表 (reviews)
```sql
CREATE TABLE reviews (
  review_id INT PRIMARY KEY AUTO_INCREMENT,
  task_id INT NOT NULL,
  from_member_id INT NOT NULL,
  to_member_id INT NOT NULL,
  rating INT NOT NULL CHECK (rating >= 1 AND rating <= 5),
  tags VARCHAR(255),
  content TEXT,
  is_anonymous BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (from_member_id) REFERENCES members(member_id),
  FOREIGN KEY (to_member_id) REFERENCES members(member_id)
);
```

### 3.2 数据库视图

#### 3.2.1 会员完整信息视图
```sql
CREATE VIEW v_member_detail AS
SELECT 
  m.*,
  u.username,
  u.email,
  u.phone,
  (SELECT AVG(rating) FROM reviews WHERE to_member_id = m.member_id) as avg_rating,
  (SELECT COUNT(*) FROM reviews WHERE to_member_id = m.member_id) as review_count
FROM members m
JOIN users u ON m.user_id = u.user_id;
```

---

## 四、API 接口文档

### 4.1 认证接口

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/auth/register | 会员注册 |
| POST | /api/auth/login | 会员登录 |
| POST | /api/auth/logout | 会员登出 |
| GET | /api/auth/me | 获取当前用户信息 |

### 4.2 会员接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/members/profile | 获取会员信息 |
| PUT | /api/members/profile | 更新会员信息 |
| POST | /api/members/avatar | 上传头像 |
| GET | /api/members/skills | 获取技能列表 |
| POST | /api/members/skills | 添加技能 |
| DELETE | /api/members/skills/:id | 删除技能 |
| GET | /api/members/credit-score | 获取信用评分 |
| GET | /api/members/reviews | 获取收到的评价 |

### 4.3 任务接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/tasks/list | 任务列表 |
| GET | /api/tasks/:id | 任务详情 |
| POST | /api/tasks/:id/claim | 认领任务 |
| GET | /api/tasks/my-claims | 我的认领 |
| PUT | /api/tasks/:id/progress | 更新进度 |
| POST | /api/tasks/:id/submit | 提交交付物 |
| PUT | /api/tasks/:id/cancel | 取消任务 |

### 4.4 回报接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/rewards/statistics | 收益统计 |
| GET | /api/rewards/records | 回报记录 |
| POST | /api/rewards/withdraw | 申请提现 |
| GET | /api/rewards/withdraw-history | 提现历史 |

### 4.5 评价接口

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/reviews | 提交评价 |
| GET | /api/reviews/member/:member_id | 获取会员评价 |
| GET | /api/reviews/task/:task_id | 获取任务评价 |

---

## 五、前端页面设计

### 5.1 页面结构

```
前端/
├── 登录/注册
│   ├── Login.vue - 登录页
│   └── Register.vue - 注册页
├── 会员中心
│   ├── Dashboard.vue - 首页/数据看板
│   ├── Profile.vue - 个人资料
│   ├── Skills.vue - 技能管理
│   ├── Reviews.vue - 评价管理
│   └── Income.vue - 收益管理
├── 任务大厅
│   ├── Tasks.vue - 任务列表
│   └── TaskDetail.vue - 任务详情
├── 我的任务
│   ├── MyTasks.vue - 我的认领
│   └── TaskProgress.vue - 任务进度
└── 布局
    └── MemberLayout.vue - 会员布局
```

### 5.2 核心页面设计

#### 5.2.1 登录/注册页
- 简洁大气的表单设计
- 表单验证
- 第三方登录预留位置

#### 5.2.2 Dashboard 首页
- 顶部统计卡片（总收益、任务数、信用分）
- 最新任务推荐
- 待办事项提醒
- 快捷操作入口

#### 5.2.3 任务大厅
- 顶部筛选栏（分类、价格、搜索）
- 任务卡片列表
- 分页加载
- 下拉刷新

#### 5.2.4 个人中心
- 头像/基本信息展示
- 左侧导航菜单
- 右侧内容区域
- 标签页切换

---

## 六、安全设计

### 6.1 身份认证
- JWT Token 认证
- Token 过期机制
- Token 刷新机制
- 密码加密存储（bcrypt）

### 6.2 数据安全
- SQL 注入防护
- XSS 攻击防护
- CSRF 防护
- 文件上传安全检查

### 6.3 业务安全
- 信用分限制
- 操作频率限制
- 异常行为检测
- 敏感操作二次确认

---

## 七、性能优化

### 7.1 后端优化
- 数据库索引优化
- 查询缓存（Redis）
- 接口响应压缩
- 图片 CDN 加速

### 7.2 前端优化
- 路由懒加载
- 组件按需加载
- 图片懒加载
- 虚拟滚动（任务列表）

---

## 八、测试计划

### 8.1 单元测试
- 控制器测试
- 模型测试
- 工具函数测试

### 8.2 集成测试
- API 接口测试
- 数据库操作测试
- 业务流程测试

### 8.3 性能测试
- 接口响应时间
- 并发处理能力
- 数据库查询性能

---

## 九、部署方案

### 9.1 环境配置
- 开发环境
- 测试环境
- 生产环境

### 9.2 部署流程
1. 代码提交
2. 自动构建
3. 自动测试
4. 自动部署
5. 健康检查

### 9.3 监控告警
- 系统监控
- 错误监控
- 性能监控
- 业务监控

---

## 十、开发计划

### Week 1: 基础架构
- 项目初始化
- 数据库设计
- 用户认证功能
- 基础页面搭建

### Week 2: 核心功能
- 会员个人中心
- 任务大厅
- 任务认领功能
- 任务进度管理

### Week 3: 回报与评价
- 收益统计
- 提现功能
- 评价功能
- 信用评分

### Week 4: 优化测试
- 性能优化
- 单元测试
- 集成测试
- 文档完善

---

## 十一、项目交付物

1. 后端源代码
2. 前端源代码
3. 数据库脚本
4. API 接口文档
5. 部署文档
6. 用户手册
7. 开发文档

---

## 十二、风险评估

### 12.1 技术风险
- 并发处理性能
- 数据一致性
- 第三方服务依赖

### 12.2 业务风险
- 用户活跃度不足
- 任务匹配效率
- 信用评价公正性

### 12.3 安全风险
- 数据泄露
- 账号安全
- 支付安全

### 应对措施
- 制定详细的安全规范
- 建立应急预案
- 定期安全审计
- 实时监控系统

---

## 十三、后续扩展计划

### 13.1 功能扩展
- 即时通讯功能
- 视频面试功能
- 在线协作工具
- 智能推荐算法

### 13.2 平台扩展
- 移动端 App
- 小程序版本
- 开放 API 平台

---

## 附录

### 附录 A: 数据库 ER 图
（数据库实体关系图）

### 附录 B: 接口测试用例
（详细的接口测试用例）

### 附录 C: UI 设计稿
（页面设计原型）

---

**文档版本**: v1.0  
**创建日期**: 2026-01-08  
**最后更新**: 2026-01-08  
**文档状态**: 完成
